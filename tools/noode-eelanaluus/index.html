<!doctype html>
<html lang="et">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Nõude eelanalüüs — Solvere Lab</title>
  <link rel="stylesheet" href="/assets/site.css" />
</head>

<body>
<main class="container" id="app">

  <!-- HEADER / INTRO -->
  <header class="pagehead">
    <h1>Nõude eelanalüüs</h1>
    <p class="lead">
      Struktureeritud eelanalüüs enne kohtusse pöördumist: nõude alus, riskid ja tõendite piisavus.
    </p>

    <div class="notice notice--neutral" role="note" aria-label="Oluline märkus">
      Tegemist on informatiivse eelanalüüsi tööriistaga. See ei asenda individuaalset õigusnõustamist ega prognoosi menetluse tulemust.
      Vastused salvestuvad üksnes Teie brauseris ega edastata serverisse.
    </div>

    <div class="actions">
      <button type="button" class="btn btn-primary" id="btnStart">Alusta analüüsi</button>
      <button type="button" class="btn" id="btnResetTop">Lähtesta</button>
    </div>
  </header>

  <!-- PROGRESS -->
  <section class="progresswrap" aria-label="Edenemine">
    <div class="progressbar" role="progressbar" aria-valuemin="0" aria-valuemax="6" aria-valuenow="0">
      <div class="progressbar__fill" id="progressFill" style="width:0%"></div>
    </div>
    <div class="progressmeta">
      <span id="progressLabel">Samm 0 / 6</span>
    </div>
  </section>

  <!-- STEPS (single page, step-by-step) -->
  <section class="steps" id="steps" aria-label="Küsimustik" hidden>

    <!-- STEP 1 -->
    <article class="step" data-step="1" aria-labelledby="s1-title" hidden>
      <header class="step__head">
        <h2 id="s1-title">1. Nõude alus</h2>

        <button type="button" class="infoToggle" data-info="s1-info" aria-expanded="false" aria-controls="s1-info">
          (i)
        </button>
      </header>

      <div class="step__info" id="s1-info" hidden>
        Kohustus tähendab teise poole lubadust või lepingulist või seadusest tulenevat kohustust midagi teha, mitte teha või hüvitada kahju.
        Kui kohustuse sisu ei ole selge, võib nõue olla nõrgem.
      </div>

      <fieldset class="q" aria-label="Nõude alus küsimus">
        <legend class="q__legend">Kas teisel poolel oli konkreetne kohustus, mille täitmist Te nõuate?</legend>

        <label class="opt">
          <input type="radio" name="basis" value="3" />
          <span>Jah, kohustus on kirjalikult fikseeritud</span>
        </label>

        <label class="opt">
          <input type="radio" name="basis" value="2" />
          <span>Jah, kohustus lepiti kokku suuliselt</span>
        </label>

        <label class="opt">
          <input type="radio" name="basis" value="1" />
          <span>Kohustuse sisu on ebaselge</span>
        </label>

        <label class="opt">
          <input type="radio" name="basis" value="0" />
          <span>Selgelt tuvastatavat kohustust ei ole</span>
        </label>
      </fieldset>

      <footer class="step__nav">
        <button type="button" class="btn" data-action="back" disabled>Tagasi</button>
        <button type="button" class="btn btn-primary" data-action="next">Järgmine</button>
      </footer>
    </article>

    <!-- STEP 2 -->
    <article class="step" data-step="2" aria-labelledby="s2-title" hidden>
      <header class="step__head">
        <h2 id="s2-title">2. Kohustuse rikkumine</h2>

        <button type="button" class="infoToggle" data-info="s2-info" aria-expanded="false" aria-controls="s2-info">
          (i)
        </button>
      </header>

      <div class="step__info" id="s2-info" hidden>
        Rikkumine tähendab, et kohustust ei täidetud, täideti puudulikult või hilinemisega.
        Rikkumine peab olema kirjeldatav ja seostatav konkreetse kohustusega.
      </div>

      <fieldset class="q" aria-label="Rikkumise küsimus">
        <legend class="q__legend">Kas kohustust rikuti ning kas rikkumine on kirjeldatav?</legend>

        <label class="opt">
          <input type="radio" name="breach" value="3" />
          <span>Rikkumine on selgelt tuvastatav ja dokumenteeritud</span>
        </label>

        <label class="opt">
          <input type="radio" name="breach" value="2" />
          <span>Rikkumine on tõenäoline, kuid mitte täielikult dokumenteeritud</span>
        </label>

        <label class="opt">
          <input type="radio" name="breach" value="1" />
          <span>Rikkumine on vaieldav</span>
        </label>

        <label class="opt">
          <input type="radio" name="breach" value="0" />
          <span>Rikkumise olemasolu ei ole kindel</span>
        </label>
      </fieldset>

      <footer class="step__nav">
        <button type="button" class="btn" data-action="back">Tagasi</button>
        <button type="button" class="btn btn-primary" data-action="next">Järgmine</button>
      </footer>
    </article>

    <!-- STEP 3 -->
    <article class="step" data-step="3" aria-labelledby="s3-title" hidden>
      <header class="step__head">
        <h2 id="s3-title">3. Kahju või nõude suurus</h2>

        <button type="button" class="infoToggle" data-info="s3-info" aria-expanded="false" aria-controls="s3-info">
          (i)
        </button>
      </header>

      <div class="step__info" id="s3-info" hidden>
        Kahju peab olema rahaliselt määratletav.
        Nõude suurus peaks olema arvutatav ja põhjendatav, mitte hinnanguline oletus.
      </div>

      <fieldset class="q" aria-label="Kahju küsimus">
        <legend class="q__legend">Kas nõude suurus on rahaliselt määratletud ja põhjendatav?</legend>

        <label class="opt">
          <input type="radio" name="damage" value="3" />
          <span>Summa on täpselt arvutatav ja põhjendatud</span>
        </label>

        <label class="opt">
          <input type="radio" name="damage" value="2" />
          <span>Summa on ligikaudu arvutatav</span>
        </label>

        <label class="opt">
          <input type="radio" name="damage" value="1" />
          <span>Summa on ebamäärane</span>
        </label>

        <label class="opt">
          <input type="radio" name="damage" value="0" />
          <span>Summa ei ole rahaliselt määratletud</span>
        </label>
      </fieldset>

      <footer class="step__nav">
        <button type="button" class="btn" data-action="back">Tagasi</button>
        <button type="button" class="btn btn-primary" data-action="next">Järgmine</button>
      </footer>
    </article>

    <!-- STEP 4 (weighted x2) -->
    <article class="step step--weighted" data-step="4" aria-labelledby="s4-title" hidden>
      <header class="step__head">
        <h2 id="s4-title">4. Tõendite olemasolu</h2>

        <button type="button" class="infoToggle" data-info="s4-info" aria-expanded="false" aria-controls="s4-info">
          (i)
        </button>
      </header>

      <div class="step__info" id="s4-info" hidden>
        Tõendid võivad olla kirjalikud dokumendid, kirjavahetus, arved, lepingud või muud objektiivsed andmed.
        Kohtuvaidluses hinnatakse eelkõige tõendite olemasolu ja usaldusväärsust.
      </div>

      <fieldset class="q" aria-label="Tõendite küsimus">
        <legend class="q__legend">Millised tõendid kinnitavad Teie väidet?</legend>

        <label class="opt">
          <input type="radio" name="evidence" value="3" />
          <span>Mitmed kirjalikud või objektiivsed tõendid</span>
        </label>

        <label class="opt">
          <input type="radio" name="evidence" value="2" />
          <span>Mõned kirjalikud või muud tõendid</span>
        </label>

        <label class="opt">
          <input type="radio" name="evidence" value="1" />
          <span>Piiratud või kaudsed tõendid</span>
        </label>

        <label class="opt">
          <input type="radio" name="evidence" value="0" />
          <span>Tõendid puuduvad</span>
        </label>
      </fieldset>

      <footer class="step__nav">
        <button type="button" class="btn" data-action="back">Tagasi</button>
        <button type="button" class="btn btn-primary" data-action="next">Järgmine</button>
      </footer>
    </article>

    <!-- STEP 5 -->
    <article class="step" data-step="5" aria-labelledby="s5-title" hidden>
      <header class="step__head">
        <h2 id="s5-title">5. Võimalikud vastuväited</h2>

        <button type="button" class="infoToggle" data-info="s5-info" aria-expanded="false" aria-controls="s5-info">
          (i)
        </button>
      </header>

      <div class="step__info" id="s5-info" hidden>
        Vastuväited on põhjendused, millega teine pool võib nõudele vastu vaielda.
        Näiteks võib väita, et kohustust ei olnud, kahju ei tekkinud või nõue on aegunud.
      </div>

      <fieldset class="q" aria-label="Vastuväidete küsimus">
        <legend class="q__legend">Kui tõenäoline on, et teine pool suudab esitada tugevaid vastuväiteid?</legend>

        <label class="opt">
          <input type="radio" name="defenses" value="3" />
          <span>Vähetõenäoline</span>
        </label>

        <label class="opt">
          <input type="radio" name="defenses" value="2" />
          <span>Võimalik</span>
        </label>

        <label class="opt">
          <input type="radio" name="defenses" value="1" />
          <span>Tõenäoline</span>
        </label>

        <label class="opt">
          <input type="radio" name="defenses" value="0" />
          <span>Väga tõenäoline</span>
        </label>
      </fieldset>

      <footer class="step__nav">
        <button type="button" class="btn" data-action="back">Tagasi</button>
        <button type="button" class="btn btn-primary" data-action="next">Järgmine</button>
      </footer>
    </article>

    <!-- STEP 6 (weighted x2) -->
    <article class="step step--weighted" data-step="6" aria-labelledby="s6-title" hidden>
      <header class="step__head">
        <h2 id="s6-title">6. Aegumisküsimus</h2>

        <button type="button" class="infoToggle" data-info="s6-info" aria-expanded="false" aria-controls="s6-info">
          (i)
        </button>
      </header>

      <div class="step__info" id="s6-info" hidden>
        Aegumine tähendab, et seaduses ettenähtud tähtaja möödumisel võib nõude maksmapanek olla piiratud.
        Tähtajad sõltuvad nõude liigist ja asjaoludest.
      </div>

      <fieldset class="q" aria-label="Aegumise küsimus">
        <legend class="q__legend">Kas on võimalik, et nõue on aegunud või aegumas?</legend>

        <label class="opt">
          <input type="radio" name="limitation" value="3" />
          <span>Ei</span>
        </label>

        <label class="opt">
          <input type="radio" name="limitation" value="2" />
          <span>Ebatõenäoline</span>
        </label>

        <label class="opt">
          <input type="radio" name="limitation" value="1" />
          <span>Võimalik</span>
        </label>

        <label class="opt">
          <input type="radio" name="limitation" value="0" />
          <span>Tõenäoline</span>
        </label>
      </fieldset>

      <footer class="step__nav">
        <button type="button" class="btn" data-action="back">Tagasi</button>
        <button type="button" class="btn btn-primary" data-action="finish">Vaata tulemust</button>
      </footer>
    </article>

  </section>

  <!-- RESULTS -->
  <section class="results" id="results" aria-label="Tulemus" hidden>
    <header class="results__head">
      <h2>Tulemus</h2>
      <p class="muted">
        Hinnang põhineb kaalutud riskikomponentidel, sealhulgas tõendite olemasolul ja aegumisküsimusel.
      </p>
    </header>

    <!-- Overall -->
    <div class="card overall" id="overallCard" data-level="unknown">
      <div class="overall__badge" id="overallBadge" aria-label="Üldhinnangu indikaator">—</div>
      <div class="overall__text">
        <div class="overall__title" id="overallTitle">Üldine riskiprofiil</div>
        <div class="overall__desc" id="overallDesc">Täida küsimustik, et kuvada hinnang.</div>
      </div>
    </div>

    <!-- Grid (2x3) -->
    <div class="grid grid-2x3" id="riskGrid">
      <div class="card metric" id="m-basis" data-level="unknown">
        <div class="metric__head">
          <div class="metric__name">Nõude alus</div>
          <div class="metric__dot" aria-hidden="true"></div>
        </div>
        <div class="metric__label" id="m-basis-label">—</div>
        <div class="metric__note" id="m-basis-note">—</div>
      </div>

      <div class="card metric" id="m-breach" data-level="unknown">
        <div class="metric__head">
          <div class="metric__name">Rikkumine</div>
          <div class="metric__dot" aria-hidden="true"></div>
        </div>
        <div class="metric__label" id="m-breach-label">—</div>
        <div class="metric__note" id="m-breach-note">—</div>
      </div>

      <div class="card metric" id="m-damage" data-level="unknown">
        <div class="metric__head">
          <div class="metric__name">Kahju</div>
          <div class="metric__dot" aria-hidden="true"></div>
        </div>
        <div class="metric__label" id="m-damage-label">—</div>
        <div class="metric__note" id="m-damage-note">—</div>
      </div>

      <div class="card metric" id="m-defenses" data-level="unknown">
        <div class="metric__head">
          <div class="metric__name">Vastuväited</div>
          <div class="metric__dot" aria-hidden="true"></div>
        </div>
        <div class="metric__label" id="m-defenses-label">—</div>
        <div class="metric__note" id="m-defenses-note">—</div>
      </div>

      <div class="card metric metric--weighted" id="m-evidence" data-level="unknown">
        <div class="metric__head">
          <div class="metric__name">Tõendid</div>
          <div class="metric__dot" aria-hidden="true"></div>
        </div>
        <div class="metric__label" id="m-evidence-label">—</div>
        <div class="metric__note" id="m-evidence-note">—</div>
      </div>

      <div class="card metric metric--weighted" id="m-limitation" data-level="unknown">
        <div class="metric__head">
          <div class="metric__name">Aegumine</div>
          <div class="metric__dot" aria-hidden="true"></div>
        </div>
        <div class="metric__label" id="m-limitation-label">—</div>
        <div class="metric__note" id="m-limitation-note">—</div>
      </div>
    </div>

    <div class="notice notice--neutral results__note" role="note">
      Tegemist on informatiivse eelanalüüsiga ega asenda õigusnõustamist.
      Sügavam struktureeritud analüüs (hagi eelhindamise protokoll) on arendamisel.
    </div>

    <div class="actions">
      <button type="button" class="btn" id="btnEdit">Muuda vastuseid</button>
      <button type="button" class="btn" id="btnResetBottom">Lähtesta</button>
    </div>
  </section>

</main>

<script>
/**
 * Skeleton JS hooks (no scoring implementation yet)
 * - Step navigation (Next/Back/Finish)
 * - Progress updates
 * - Info toggles
 * - Session persistence placeholders
 */
(() => {
  const STORAGE_KEY = "solverelab_claim_precheck_v1";

  const stepsWrap = document.getElementById("steps");
  const steps = Array.from(document.querySelectorAll(".step"));
  const results = document.getElementById("results");

  const btnStart = document.getElementById("btnStart");
  const btnEdit = document.getElementById("btnEdit");
  const btnResetTop = document.getElementById("btnResetTop");
  const btnResetBottom = document.getElementById("btnResetBottom");

  const progressFill = document.getElementById("progressFill");
  const progressLabel = document.getElementById("progressLabel");
  const progressBar = document.querySelector(".progressbar");

  let currentStep = 1;

  function showStep(n) {
    currentStep = n;
    steps.forEach(s => s.hidden = (Number(s.dataset.step) !== n));
    stepsWrap.hidden = false;
    results.hidden = true;

    const pct = Math.round((n - 1) / 6 * 100);
    progressFill.style.width = pct + "%";
    progressLabel.textContent = `Samm ${n} / 6`;
    progressBar.setAttribute("aria-valuenow", String(n - 1));

    // Optional: scroll to steps
    stepsWrap.scrollIntoView({ behavior: "smooth", block: "start" });
  }

  function showResults() {
    stepsWrap.hidden = false; // keep in DOM; we’ll scroll to results
    steps.forEach(s => s.hidden = true);
    results.hidden = false;

    progressFill.style.width = "100%";
    progressLabel.textContent = "Samm 6 / 6";
    progressBar.setAttribute("aria-valuenow", "6");

    results.scrollIntoView({ behavior: "smooth", block: "start" });
  }

  function bindNav() {
    document.addEventListener("click", (e) => {
      const btn = e.target.closest("button");
      if (!btn) return;

      // Info toggles
      if (btn.classList.contains("infoToggle")) {
        const infoId = btn.getAttribute("data-info");
        const infoEl = document.getElementById(infoId);
        const expanded = btn.getAttribute("aria-expanded") === "true";
        btn.setAttribute("aria-expanded", String(!expanded));
        infoEl.hidden = expanded;
        return;
      }

      const action = btn.getAttribute("data-action");
      if (!action) return;

      if (action === "back") {
        if (currentStep > 1) showStep(currentStep - 1);
        return;
      }

      if (action === "next") {
        // TODO: validate current step answered before proceeding
        if (currentStep < 6) showStep(currentStep + 1);
        return;
      }

      if (action === "finish") {
        // TODO: validate all answered + compute + render dashboard
        showResults();
        return;
      }
    });
  }

  function resetAll() {
    // Clear form inputs
    document.querySelectorAll('input[type="radio"]').forEach(i => i.checked = false);

    // Clear storage
    sessionStorage.removeItem(STORAGE_KEY);

    // Reset UI
    progressFill.style.width = "0%";
    progressLabel.textContent = "Samm 0 / 6";
    progressBar.setAttribute("aria-valuenow", "0");
    results.hidden = true;
    stepsWrap.hidden = true;

    // Scroll top
    document.getElementById("app").scrollIntoView({ behavior: "smooth", block: "start" });
  }

  btnStart.addEventListener("click", () => showStep(1));
  btnEdit?.addEventListener("click", () => showStep(1));
  btnResetTop.addEventListener("click", resetAll);
  btnResetBottom?.addEventListener("click", resetAll);

  bindNav();

  // TODO (next step): load saved answers from sessionStorage + resume step
})();
</script>

</body>
</html>
